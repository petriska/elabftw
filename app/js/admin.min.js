/*! elabftw https://www.elabftw.net */

!function(){"use strict";$(document).ready(function(){var TeamGroups={controller:"app/controllers/TeamGroupsController.php",create:function(){var name=$("#teamGroupCreate").val();name.length>0&&$.post(this.controller,{teamGroupCreate:name}).done(function(){$("#team_groups_div").load("admin.php #team_groups_div"),$("#teamGroupCreate").val(""),notif("Saved","ok")})},update:function(action){var user,group;"add"===action?(user=$("#teamGroupUserAdd").val(),group=$("#teamGroupGroupAdd").val()):(user=$("#teamGroupUserRm").val(),group=$("#teamGroupGroupRm").val()),$.post(this.controller,{teamGroupUpdate:!0,action:action,teamGroupUser:user,teamGroupGroup:group}).done(function(){$("#team_groups_div").load("admin.php #team_groups_div")})},destroy:function(id,confirmText){return confirm(confirmText)&&$.post(this.controller,{teamGroupDestroy:!0,teamGroupGroup:id}).done(function(){$("#team_groups_div").load("admin.php #team_groups_div")}),!1}};$(document).on("click",".archive-user",function(e){e.preventDefault(),confirm("Are you sure you want to archive this user?")&&$.post("app/controllers/UsersController.php",{usersArchive:!0,userid:$(this).data("userid")}).done(function(data){data.res?(notif(data.msg,"ok"),window.location.replace("admin.php?tab=2")):notif(data.msg,"ko")})}),$(document).on("click","#teamGroupCreateBtn",function(){TeamGroups.create()}),$(document).on("click","#teamGroupGroupAddBtn",function(){TeamGroups.update("add")}),$(document).on("click","#teamGroupGroupRmBtn",function(){TeamGroups.update("rm")}),$(document).on("click",".teamGroupDelete",function(){TeamGroups.destroy($(this).data("id"),$(this).data("confirm"))});var Status={controller:"app/controllers/StatusController.php",create:function(){var name=$("#statusName").val(),color=$("#statusColor").val(),isTimestampable=+$("#statusTimestamp").is(":checked");$.post(this.controller,{statusCreate:!0,name:name,color:color,isTimestampable:isTimestampable}).done(function(data){data.res?(notif(data.msg,"ok"),window.location.replace("admin.php?tab=4")):notif(data.msg,"ko")})},update:function(id){var name=$("#statusName_"+id).val(),color=$("#statusColor_"+id).val(),isTimestampable=+$("#statusTimestamp_"+id).is(":checked"),isDefault=$("#statusDefault_"+id).is(":checked");$.post(this.controller,{statusUpdate:!0,id:id,name:name,color:color,isTimestampable:isTimestampable,isDefault:isDefault}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})},destroy:function(id){$.post(this.controller,{statusDestroy:!0,id:id}).done(function(data){data.res?(notif(data.msg,"ok"),$("#status_"+id).hide()):notif(data.msg,"ko")})}};$(document).on("click","#statusCreate",function(){Status.create()}),$(document).on("click",".statusSave",function(){Status.update($(this).data("id"))}),$(document).on("click",".statusDestroy",function(){Status.destroy($(this).data("id"))});var ItemsTypes={controller:"app/controllers/ItemsTypesController.php",create:function(){var name=$("#itemsTypesName").val(),color=$("#itemsTypesColor").val(),bookable=0;$("#itemsTypesBookable").is(":checked")&&(bookable=1);var template=tinymce.get("itemsTypesTemplate").getContent();$.post(this.controller,{itemsTypesCreate:!0,name:name,color:color,bookable:bookable,template:template}).done(function(data){data.res?(notif(data.msg,"ok"),window.location.replace("admin.php?tab=5")):notif(data.msg,"ko")})},showEditor:function(id){$("#itemsTypesEditor_"+id).toggle()},update:function(id){var name=$("#itemsTypesName_"+id).val(),color=$("#itemsTypesColor_"+id).val(),bookable=0;$("#itemsTypesBookable_"+id).is(":checked")&&(bookable=1);var template=tinymce.get("itemsTypesTemplate_"+id).getContent();$.post(this.controller,{itemsTypesUpdate:!0,id:id,name:name,color:color,bookable:bookable,template:template}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})},destroy:function(id){$.post(this.controller,{itemsTypesDestroy:!0,id:id}).done(function(data){data.res?(notif(data.msg,"ok"),$("#itemstypes_"+id).hide()):notif(data.msg,"ko")})}};$(".itemsTypesEditor").hide(),$(document).on("click","#itemsTypesCreate",function(){ItemsTypes.create()}),$(document).on("click",".itemsTypesShowEditor",function(){ItemsTypes.showEditor($(this).data("id"))}),$(document).on("click",".itemsTypesUpdate",function(){ItemsTypes.update($(this).data("id"))}),$(document).on("click",".itemsTypesDestroy",function(){ItemsTypes.destroy($(this).data("id"))}),$("#commonTplTemplate").closest("div").find(".button").click(function(){var template=tinymce.get("commonTplTemplate").getContent();$.post("app/controllers/AdminController.php",{commonTplUpdate:template}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})}),$(".item-selector").on("change",function(){document.cookie="itemType="+this.value,$(".import_block").show()}),$("#create_teamgroup").keypress(function(e){var keynum;e.which&&(keynum=e.which),13===keynum&&teamGroupCreate()}),$("h3.teamgroup_name").editable("app/controllers/TeamGroupsController.php",{indicator:"Saving...",name:"teamGroupUpdateName",submit:"Save",cancel:"Cancel",style:"display:inline"}),$(".sortable_status").sortable({axis:"y",helper:"clone",update:function(event,ui){var ordering=$(".sortable_status").sortable("toArray");$.post("app/controllers/AdminController.php",{updateOrdering:!0,table:"status",ordering:ordering}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})}}),$(".sortable_itemstypes").sortable({axis:"y",helper:"clone",update:function(event,ui){var ordering=$(".sortable_itemstypes").sortable("toArray");$.post("app/controllers/AdminController.php",{updateOrdering:!0,table:"items_types",ordering:ordering}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})}}),$(".import_block").hide(),$(".colorpicker").colorpicker({hsv:!1,okOnEnter:!0,rgb:!1});var colorInput=Math.floor(16777215*Math.random()).toString(16);$("#itemsTypesColor").val(colorInput),$("#statusColor").val(colorInput),tinymce.init({mode:"specific_textareas",editor_selector:"mceditable",content_css:"app/css/tinymce.css",plugins:"table textcolor searchreplace lists advlist code fullscreen insertdatetime paste charmap save image link",toolbar1:"undo redo | bold italic underline | fontsizeselect | alignleft aligncenter alignright alignjustify | superscript subscript | bullist numlist outdent indent | forecolor backcolor | charmap | link",removed_menuitems:"newdocument",language:$("#commonTplTemplate").data("lang")})})}();