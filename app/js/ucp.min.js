/*! elabftw https://www.elabftw.net */

!function(){"use strict";$(document).ready(function(){var confirmText=$("#entityInfos").data("confirm"),Tag={controller:"app/controllers/EntityController.php",create:function(e,id){var keynum;if(e.which&&(keynum=e.which),13===keynum){var tag=$("#createTagInput_"+id).val();$.post(this.controller,{createTag:!0,tag:tag,id:id,type:"tpl"}).done(function(){$("#tags_div_"+id).load(" #tags_div_"+id),$("#createTagInput_"+id).val("")})}},destroy:function(tag,id){confirm(confirmText)&&$.post(this.controller,{destroyTag:!0,type:"tpl",id:id,tag_id:tag}).done(function(){$("#tags_div_"+id).load(" #tags_div_"+id)})}};$(document).on("keypress",".createTagInput",function(e){var id=$(this).data("id");Tag.create(e,id)}),$(document).on("click",".tagDestroy",function(){var id=$(this).data("id");Tag.destroy($(this).data("tagid"),id)});var cache={};$(".createTagInput").autocomplete({source:function(request,response){var term=request.term;term in cache?response(cache[term]):$.getJSON("app/controllers/EntityController.php?tag=1&type=experiments&id=1",request,function(data,status,xhr){cache[term]=data,response(data)})}});var Templates={controller:"app/controllers/EntityController.php",saveToFile:function(id,name){var content=tinyMCE.get(id).getContent(),blob=new Blob([content],{type:"text/plain;charset=utf-8"});saveAs(blob,name+".elabftw.tpl")},destroy:function(id){confirm("Delete this ?")&&$.post(this.controller,{destroy:!0,id:id,type:"tpl"}).done(function(data){data.res?(notif(data.msg,"ok"),window.location.replace("?tab=3")):notif(data.msg,"ko")})}};$(document).on("click",".save-to-file",function(){Templates.saveToFile($(this).data("id"),$(this).data("name"))}),$(document).on("click",".destroy-template",function(){Templates.destroy($(this).data("id"))}),$("#import_tpl").hide(),$(document).on("click","#import-from-file",function(){$("#import_tpl").toggle()}),$("#import_tpl").on("change",function(e){var title=document.getElementById("import_tpl").value.replace(".elabftw.tpl","").replace("C:\\fakepath\\","");readFile(this.files[0],function(e){tinyMCE.get("new_tpl_txt").setContent(e.target.result),$("#new_tpl_name").val(title),$("#import_tpl").hide()})}),$(".nav-pills").sortable({axis:"x",helper:"clone",cancel:"#subtab_1",update:function(event,ui){var ordering=$(".nav-pills").sortable("toArray");$.post("app/controllers/UcpController.php",{updateOrdering:!0,table:"experiments_templates",ordering:ordering}).done(function(data){data.res?notif(data.msg,"ok"):notif(data.msg,"ko")})}});$(".subdivhandle").hide(),$("#subtab_1div").show(),$("#subtab_1").addClass("selected"),$(".subtabhandle").click(function(event){var tabhandle="#"+event.target.id,divhandle="#"+event.target.id+"div";$(".subdivhandle").hide(),$(divhandle).show(),$(".subtabhandle").removeClass("badgetabactive"),$(tabhandle).addClass("badgetabactive")}),tinymce.init({mode:"specific_textareas",editor_selector:"mceditable",content_css:"app/css/tinymce.css",plugins:"table textcolor searchreplace code lists advlist fullscreen insertdatetime paste charmap save image link",toolbar1:"undo redo | bold italic underline | fontsizeselect | alignleft aligncenter alignright alignjustify | superscript subscript | bullist numlist outdent indent | forecolor backcolor | charmap | link",removed_menuitems:"newdocument",language:$("#language").data("lang")})})}();